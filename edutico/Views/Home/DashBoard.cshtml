@{
    ViewData["Title"] = "DashBoard";
    Layout = "_LayoutFunc";
}

<div class="container">
    <form class="d-flex justify-content-center align-items-center search-bar">
        <img src="~/imgs/lupa.png" class="icone" style="height: 18px; width: 18px; opacity: 0.3; margin-left: 10px; margin-top: 5px;">
        <input class="layout-label" type="search" placeholder="Procurar" aria-label="Search" style="font-family:'Glacial Bold'; opacity: 0.5;">
    </form>
    <div class="my-5">
        <h5 id="glacial-bold">Acompanhe a movimentação do e-commerce</h5>
        <!--div de menus horizontais-->
        <div class="d-flex my-3 justify-content-between">
            <!--abre outra página ao clicar-->
            <a asp-controller="Home" asp-action="PedidosAndamentoF">
                <div class="base">
                    <img src="~/imgs/cesta.png" class="icone-menu" />
                    <!--nome do menu-->
                    <h6>Pedidos pendentes</h6>
                    <!--quantidade-->
                    <h5 id="glacial-bold">500</h5>
                </div>
            </a>
            <a asp-controller="Home" asp-action="FavoritosF">
                <div class="base">
                    <img src="~/imgs/curtidos.png" class="icone-menu" />
                    <!--nome do menu-->
                    <h6>Produtos curtidos</h6>
                    <!--quantidade-->
                    <h5 id="glacial-bold">500</h5>
                </div>
            </a>
            <a asp-controller="Home" asp-action="HistoricoVendasF">
                <div class="base">
                    <img src="~/imgs/vendas.png" class="icone-menu" />
                    <!--nome do menu-->
                    <h6>Vendas realizadas</h6>
                    <!--quantidade com porcentagem-->
                    <h5 id="glacial-bold">500 <span style="color:limegreen;" id="porcentagem">+25%</span></h5>
                </div>
            </a>
            <a asp-controller="Home" asp-action="ProdutosF">
                <div class="base">
                    <img src="~/imgs/esgotados.png" class="icone-menu" />
                    <!--nome do menu-->
                    <h6>Produtos esgotados</h6>
                    <!--quantidade com porcentagem-->
                    <h5 id="glacial-bold">500 <span style="color:#F00;" id="porcentagem">+15%</span></h5>
                </div>
            </a>
        </div>
        <!--encerra menu horizontais-->
    </div>

    <!--inicio de div que agrupa produtos e grafico-->
    <div class="row">
        <!--inicia div produtos-->
        <div class="col-6">
            <h5 id="glacial-bold">Produtos mais vendidos</h5>
            <!--inicia lista de produtos-->
            <div class="conjunto-prod mt-3">
                <div class="scroll">
                    <!--inica produto-->
                    <div class="item-prod d-flex align-items-center justify-content-between">
                        <!--3 divs de infomrações do produto-->
                        <div class="d-flex align-items-center">
                            <img src="~/imgs/img_prod_padrao_quadrada.png" class="img-prod" />
                            <div class="ms-4">
                                <p class="nome-prod">Nome Produto</p>
                                <p style="color: #BBB;">Pedidos: <span>1000</span></p>
                            </div>
                        </div>
                        <div class="d-flex">
                            <div class="me-2" style="color: #BBB;">
                                <p>Preço</p>
                                <p>Total</p>
                            </div>
                            <div id="glacial-bold">
                                <p>R$ 12,00</p>
                                <p>R$ 1.000</p>
                            </div>
                            <!--encerra 3 divs de infomrações do produto-->
                        </div>
                        <!--temrmina produto-->
                    </div>
                    <!--termina lista de produtos-->
                    <!--inica produto-->
                    <div class="item-prod d-flex align-items-center justify-content-between">
                        <!--3 divs de infomrações do produto-->
                        <div class="d-flex align-items-center">
                            <img src="~/imgs/img_prod_padrao_quadrada.png" class="img-prod" />
                            <div class="ms-4">
                                <p class="nome-prod">Nome Produto</p>
                                <p style="color: #BBB;">Pedidos: <span>1000</span></p>
                            </div>
                        </div>
                        <div class="d-flex">
                            <div class="me-2" style="color: #BBB;">
                                <p>Preço</p>
                                <p>Total</p>
                            </div>
                            <div id="glacial-bold">
                                <p>R$ 12,00</p>
                                <p>R$ 1.000</p>
                            </div>
                            <!--encerra 3 divs de infomrações do produto-->
                        </div>
                        <!--temrmina produto-->
                    </div>
                    <!--termina lista de produtos-->
                    <!--inica produto-->
                    <div class="item-prod d-flex align-items-center justify-content-between">
                        <!--3 divs de infomrações do produto-->
                        <div class="d-flex align-items-center">
                            <img src="~/imgs/img_prod_padrao_quadrada.png" class="img-prod" />
                            <div class="ms-4">
                                <p class="nome-prod">Nome Produto</p>
                                <p style="color: #BBB;">Pedidos: <span>1000</span></p>
                            </div>
                        </div>
                        <div class="d-flex">
                            <div class="me-2" style="color: #BBB;">
                                <p>Preço</p>
                                <p>Total</p>
                            </div>
                            <div id="glacial-bold">
                                <p>R$ 12,00</p>
                                <p>R$ 1.000</p>
                            </div>
                            <!--encerra 3 divs de infomrações do produto-->
                        </div>
                        <!--temrmina produto-->
                    </div>
                    <!--termina lista de produtos-->
                    <!--inica produto-->
                    <div class="item-prod d-flex align-items-center justify-content-between">
                        <!--3 divs de infomrações do produto-->
                        <div class="d-flex align-items-center">
                            <img src="~/imgs/img_prod_padrao_quadrada.png" class="img-prod" />
                            <div class="ms-4">
                                <p class="nome-prod">Nome Produto</p>
                                <p style="color: #BBB;">Pedidos: <span>1000</span></p>
                            </div>
                        </div>
                        <div class="d-flex">
                            <div class="me-2" style="color: #BBB;">
                                <p>Preço</p>
                                <p>Total</p>
                            </div>
                            <div id="glacial-bold">
                                <p>R$ 12,00</p>
                                <p>R$ 1.000</p>
                            </div>
                            <!--encerra 3 divs de infomrações do produto-->
                        </div>
                        <!--temrmina produto-->
                    </div>
                    <!--termina lista de produtos-->
                    <!--inica produto-->
                    <div class="item-prod d-flex align-items-center justify-content-between">
                        <!--3 divs de infomrações do produto-->
                        <div class="d-flex align-items-center">
                            <img src="~/imgs/img_prod_padrao_quadrada.png" class="img-prod" />
                            <div class="ms-4">
                                <p class="nome-prod">Nome Produto</p>
                                <p style="color: #BBB;">Pedidos: <span>1000</span></p>
                            </div>
                        </div>
                        <div class="d-flex">
                            <div class="me-2" style="color: #BBB;">
                                <p>Preço</p>
                                <p>Total</p>
                            </div>
                            <div id="glacial-bold">
                                <p>R$ 12,00</p>
                                <p>R$ 1.000</p>
                            </div>
                            <!--encerra 3 divs de infomrações do produto-->
                        </div>
                        <!--temrmina produto-->
                    </div>
                    <!--termina lista de produtos-->
                </div>

            </div>
        </div>
        <!--encerra div produtos-->
        <!--inicio div grafico-->
        <div class="col-6">
            <h5 id="glacial-bold">Total de vendas</h5>
            <div class="base-grafico mt-3">
                <div class=" d-flex justify-content-between align-items-center">
                    <h4 id="glacial-bold">R$ 1.000,00</h4>
                    <div class="dropdown">
                        <button class="dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Última semana
                        </button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item" href="#" onclick="updateChart('week', 'Última semana')">Última semana</a>
                            <a class="dropdown-item" href="#" onclick="updateChart('month', 'Último mês')">Último mês</a>
                            <a class="dropdown-item" href="#" onclick="updateChart('year', 'Último ano')">Último ano</a>
                        </div>
                    </div>

                </div>
                <div class="card-body">
                    <canvas id="myAreaChart"></canvas>
                </div>
            </div>



        </div>
    </div>
    <!--encerra fiv gradico-->
</div>
<!--encerra div que agrupa produtos e grafico-->
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="~/js/chart-area-demo.js"></script>
<script src="~/js/chart-pie-demo.js"></script>
<script src="~/js/Chart.min.js"></script>
<!-- Inclui jQuery (necessário para Bootstrap 4) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Inclui o JavaScript do Bootstrap -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

<script>
    function number_format(number, decimals, dec_point, thousands_sep) {
        // *     example: number_format(1234.56, 2, ',', ' ');
        // *     return: '1 234,56'
        number = (number + '').replace(',', '').replace(' ', '');
        var n = !isFinite(+number) ? 0 : +number,
            prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
            sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
            dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
            s = '',
            toFixedFix = function (n, prec) {
                var k = Math.pow(10, prec);
                return '' + Math.round(n * k) / k;
            };
        // Fix for IE parseFloat(0.55).toFixed(0) = 0;
        s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
        if (s[0].length > 3) {
            s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
        }
        if ((s[1] || '').length < prec) {
            s[1] = s[1] || '';
            s[1] += new Array(prec - s[1].length + 1).join('0');
        }
        return s.join(dec);
    }


    var ctx = document.getElementById('myAreaChart').getContext('2d');
    var chart;

    function createChart(data, labels) {
        if (chart) {
            chart.destroy(); // Destrói o gráfico existente antes de criar um novo
        }
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Valor líquido',
                    data: data,
                    borderColor: '#3e63dd',
                    backgroundColor: 'rgba(62, 99, 221, 0.1)',
                    borderWidth: 2,
                    pointRadius: 3,
                    tension: 0.4
                }]
            },
            options: {
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function (value) {
                                return 'R$' + value; // Prefixo de reais
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Modifiquei a função para também alterar o texto do botão
    function updateChart(period, labelText) {
        var data, labels;

        if (period === 'week') {
            labels = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            data = [50, 100, 150, 200, 250, 300, 350];
        } else if (period === 'month') {
            labels = ['Semana 1', 'Semana 2', 'Semana 3', 'Semana 4'];
            data = [500, 800, 1000, 600];
        } else if (period === 'year') {
            labels = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            data = [1200, 1400, 1100, 1600, 1700, 1450, 1800, 1350, 1600, 1400, 1300, 1900];
        }

        // Atualiza o gráfico com os novos dados
        createChart(data, labels);

        // Atualiza o texto do botão para a seleção atual
        document.getElementById('dropdownMenuButton').innerText = labelText;
    }

    // Inicializa o gráfico com dados da semana
    updateChart('week', 'Última semana');

</script>